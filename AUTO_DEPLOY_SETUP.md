# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –∏–∑ GitLab

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–ò–∑–º–µ–Ω–µ–Ω–∏—è, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ GitLab, –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω CI/CD –ø—Ä–æ—Ü–µ—Å—Å.

## üõ†Ô∏è –†–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: GitLab CI/CD (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

#### 1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ GitLab

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à GitLab –ø—Ä–æ–µ–∫—Ç
2. –û—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **CI/CD** ‚Üí **Variables**
3. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
SSH_PRIVATE_KEY: –≤–∞—à_–ø—Ä–∏–≤–∞—Ç–Ω—ã–π_ssh_–∫–ª—é—á
SSH_KNOWN_HOSTS: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥—ã ssh-keyscan -H –≤–∞—à_—Å–µ—Ä–≤–µ—Ä.com
SSH_USER: –∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è_–Ω–∞_—Å–µ—Ä–≤–µ—Ä–µ
SSH_HOST: IP_–∏–ª–∏_–¥–æ–º–µ–Ω_—Å–µ—Ä–≤–µ—Ä–∞
PROJECT_PATH: /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É/–Ω–∞/—Å–µ—Ä–≤–µ—Ä–µ
SERVER_URL: http://–≤–∞—à_—Å–µ—Ä–≤–µ—Ä.com
```

#### 1.2 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
ssh-keygen -t rsa -b 4096 -C "gitlab-ci@example.com"
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –∫–∞–∫ gitlab_ci_key

# –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i gitlab_ci_key.pub –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å@—Å–µ—Ä–≤–µ—Ä

# –ü–æ–ª—É—á–∏—Ç–µ SSH known hosts
ssh-keyscan -H –≤–∞—à_—Å–µ—Ä–≤–µ—Ä.com
```

#### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
git init
git remote add origin https://gitlab.com/–≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.git
git fetch origin
git checkout main
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

#### 2.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Flask
pip install flask

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export PROJECT_PATH="/–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É"
export GITLAB_BRANCH="main"
export GITLAB_WEBHOOK_SECRET="–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ webhook —Å–µ—Ä–≤–µ—Ä
python webhook_update.py
```

#### 2.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ GitLab

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Webhooks**
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π webhook:
   - **URL**: `http://–≤–∞—à_—Å–µ—Ä–≤–µ—Ä:5000/webhook/gitlab`
   - **Secret Token**: `–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á`
   - **Triggers**: –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—å–∫–æ **Push events**
   - **SSL verification**: –æ—Ç–∫–ª—é—á–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 2.3 –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞ –∫–∞–∫ —Å–ª—É–∂–±—ã

–°–æ–∑–¥–∞–π—Ç–µ systemd —Å–ª—É–∂–±—É:

```bash
sudo nano /etc/systemd/system/gitlab-webhook.service
```

```ini
[Unit]
Description=GitLab Webhook Update Service
After=network.target

[Service]
Type=simple
User=–≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
WorkingDirectory=/–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
Environment=PROJECT_PATH=/–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
Environment=GITLAB_BRANCH=main
Environment=GITLAB_WEBHOOK_SECRET=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
ExecStart=/usr/bin/python3 webhook_update.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable gitlab-webhook
sudo systemctl start gitlab-webhook
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç

#### 3.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ git (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
git init

# –î–æ–±–∞–≤—å—Ç–µ remote origin
git remote add origin https://gitlab.com/–≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.git

# –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥
git fetch origin
git checkout main
```

#### 3.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x auto_update_from_gitlab.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./auto_update_from_gitlab.sh
```

#### 3.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ crontab
crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
*/5 * * * * cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É && ./auto_update_from_gitlab.sh >> /var/log/gitlab-update.log 2>&1
```

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –î–ª—è webhook —Å–µ—Ä–≤–µ—Ä–∞
curl http://localhost:5000/health

# –î–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
curl -X POST http://localhost:5000/update

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f webhook.log
tail -f /var/log/gitlab-update.log
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å SSH –∫–ª—é—á–∞–º–∏**:
   ```bash
   ssh -T git@gitlab.com
   ```

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞**:
   ```bash
   chmod +x *.sh
   chown -R –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:–≤–∞—à_–≥—Ä—É–ø–ø–∞ /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
   ```

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å git**:
   ```bash
   git status
   git remote -v
   git log --oneline -5
   ```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–ª–æ—è

```bash
# Docker
docker-compose ps
docker-compose logs -f

# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
ps aux | grep python
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ webhook —Å–µ—Ä–≤–µ—Ä:

```python
# –í webhook_update.py –¥–æ–±–∞–≤—å—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
def send_notification(message):
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram, Slack –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
    pass
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow

1. **–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è GitLab CI/CD)
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
5. **–î–æ–±–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è webhook
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º 